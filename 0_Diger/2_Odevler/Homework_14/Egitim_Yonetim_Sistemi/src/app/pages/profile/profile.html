<app-background-item></app-background-item>
<div class="row mt-5 p-5">
  <div class="col-3"></div>
  <div class="col-6">
    <div class="card p-3">
      <div class="text-center">
        <img [src]="profilePhoto" width="120" height="120" alt="Profil Fotoğrafı" class="rounded-circle mx-auto d-block" />
        <h3 class="mt-2 mb-1">{{ user?.name }} {{ user?.surname }}</h3>
        <p class="mb-1">{{ user?.email }}</p>
        @if(user?.role){
          <span class="badge" [class.bg-primary]="user?.role==='student'" [class.bg-warning]="user?.role==='instructor'" [class.text-dark]="user?.role==='instructor'">
            {{ user?.role === 'student' ? 'Öğrenci' : 'Eğitici' }}
          </span>
        }
      </div>

      <hr />

      @if(loading()){ 
        <div class="d-flex flex-column align-items-center py-4 text-muted">
          <div class="spinner-border mb-3" role="status" style="width:2.5rem;height:2.5rem">
            <span class="visually-hidden">Yükleniyor...</span>
          </div>
          <div>Profil verileri yükleniyor...</div>
        </div>
      } @else if(empty()) {
        <div class="alert alert-info m-0">Henüz görüntülenecek kurs bulunmuyor.</div>
      } @else {
        @if(user?.role==='student'){
          <div class="d-flex gap-2 flex-wrap mb-3">
            <div class="badge bg-secondary">Kurs Sayısı: {{ studentMetrics().courseCount }}</div>
            <div class="badge bg-secondary">Toplam Süre: {{ studentMetrics().totalHours }}s</div>
            <div class="badge bg-secondary">Toplam Tutar: {{ studentMetrics().totalPrice | currency:'TRY' }}</div>
          </div>
        }
        @if(user?.role==='instructor'){
          <div class="d-flex gap-2 flex-wrap mb-3">
            <div class="badge bg-secondary">Eğitim Sayısı: {{ instructorMetrics().courseCount }}</div>
            <div class="badge bg-secondary">Toplam Öğrenci: {{ instructorMetrics().totalStudents }}</div>
          </div>
        }
        @if(!user?.role || user?.role === 'student'){
          <h5>Alınan Kurslar</h5>
          <div class="row mt-3 g-3">
            @for(cat of categories(); track cat.id){
              @if(groupedCourses()[cat.id] && groupedCourses()[cat.id].length){
                <div class="col-12">
                  <h6>{{ cat.name }}</h6>
                </div>
                @for(c of groupedCourses()[cat.id]; track c.id){
                  <div class="col-md-4">
                    <div class="card h-100">
                      <img [src]="c.image || 'assets/logo.png'" width="160" height="160" class="card-img-top" alt="{{ c.title }}" style="object-fit: cover; height: auto" />
                      <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ c.title }}</h5>
                        <p class="card-text text-muted">{{ c.instructorName }}</p>
                        <p class="card-text">{{ c.description }}</p>
                        <div class="mt-auto d-flex justify-content-between align-items-center">
                          <strong>{{ c.price | currency : 'TRY' }}</strong>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              }
            }
          </div>
        }

        @if(user?.role === 'instructor'){
          <h5>Verilen Kurslar</h5>
          @for(cat of categories(); track cat.id){
            @if(groupedCourses()[cat.id] && groupedCourses()[cat.id].length){
              <h6>{{ cat.name }}</h6>
              <ul class="mb-3">
                @for(c of groupedCourses()[cat.id]; track c.id){
                  <li>{{ c.title }}</li>
                }
              </ul>
            }
          }
        }
      }
    </div>
  </div>
  <div class="col-3"></div>
</div>
