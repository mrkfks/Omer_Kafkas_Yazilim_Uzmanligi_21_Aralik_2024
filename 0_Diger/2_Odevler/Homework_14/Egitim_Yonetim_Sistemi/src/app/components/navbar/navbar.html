<nav class="navbar navbar-dark bg-dark fixed-top">
  <div class="container-fluid">
    <img
      src="assets/logo.png"
      alt="logo"
      width="50"
      height="50"
      class="d-inline-block align-text-top"
    />

    <div class="d-flex align-items-center gap-3">
      <div class="position-relative" style="min-width:280px">
        <input
          class="form-control"
          type="search"
          placeholder="Genel arama..."
          aria-label="Arama"
          [ngModel]="query()"
          (ngModelChange)="onInput($event)"
          (keydown.enter)="goToFull()"
          (focus)="open.set(results().length>0)"
        />
        @if(searching()){
          <span class="position-absolute top-50 end-0 translate-middle-y me-3 spinner-border spinner-border-sm" aria-hidden="true"></span>
        }
        @if(open()){
          <div class="list-group position-absolute w-100 mt-1 shadow" style="z-index:1050; max-height:340px; overflow:auto">
            @for(r of results(); track r.id){
              <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" (click)="navigate(r)">
                <span class="text-start">
                  <strong>{{ r.title }}</strong>
                  @if(r.subtitle){<small class="d-block text-muted">{{ r.subtitle }}</small>}
                </span>
                <span class="badge bg-secondary text-uppercase">{{ labelOf(r.type) }}</span>
              </button>
            }
            @if(!results().length && !searching()){
              <div class="list-group-item text-muted">Sonuç yok</div>
            }
            <button type="button" class="list-group-item list-group-item-action text-center fw-semibold" (click)="goToFull()">Tüm sonuçları göster »</button>
          </div>
        }
      </div>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasDarkNavbar"
        aria-controls="offcanvasDarkNavbar"
        aria-label="Menüyü Aç/Kapat"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <div
      class="offcanvas offcanvas-end text-bg-dark"
      tabindex="-1"
      id="offcanvasDarkNavbar"
      aria-labelledby="offcanvasDarkNavbarLabel"
    >
      <div class="offcanvas-header d-flex align-items-center gap-3">
        <ng-container *ngIf="auth.currentUser() as user">
          <img
            [src]="user.profilePhoto || 'assets/logo.png'"
            alt="avatar"
            width="48"
            height="48"
            style="border-radius: 50%; object-fit: cover"
            class="me-2"
          />
          <div class="d-flex flex-column">
            <div class="text-white fw-bold">{{ user.name }} {{ user.surname }}</div>
            <button class="btn btn-sm btn-outline-light mt-1" (click)="logout()">Çıkış Yap</button>
          </div>
        </ng-container>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <div class="d-flex flex-column h-100">
          <ul class="navbar-nav justify-content-end pe-3">
            <li class="nav-item"></li>
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                routerLink="/"
                routerLinkActive="active"
                >Ana Sayfa</a
              >
            </li>
            @if (auth.currentUser()) {
              <li class="nav-item">
                <a class="nav-link" routerLink="/profile" routerLinkActive="active">Profil</a>
              </li>
            }
            <li class="nav-item dropdown">
              <a class="nav-link" routerLink="/courses" routerLinkActive="active">Kurslar</a>
            </li>
            @if (auth.currentUser()?.role === 'instructor') {
              <li class="nav-item">
                <a class="nav-link" routerLink="/edit-courses" routerLinkActive="active">Kursları Yönet</a>
              </li>
            }
            <li class="nav-item dropdown">
              <a class="nav-link" routerLink="/about-us" routerLinkActive="active">Hakkımızda</a>
            </li>
          </ul>
          <div class="mt-auto w-100">
            <div class="accordion bg-dark text-white border-0" id="accordionExample">
              <div class="accordion-item bg-dark text-white border-0">
                <h2 class="accordion-header bg-dark text-white border-0" id="headingOne">
                  <button
                    class="accordion-button bg-dark text-white border-0"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseOne"
                    aria-expanded="false"
                    aria-controls="collapseOne"
                  >
                    Kişisel Verileri Koruma Kanunu
                  </button>
                </h2>
                <div
                  id="collapseOne"
                  class="accordion-collapse collapse bg-dark text-white border-0"
                  aria-labelledby="headingOne"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body bg-dark text-white border-0">
                    6698 sayılı Kişisel Verilerin Korunması Kanunu (KVKK), bireylerin kişisel
                    verilerinin hukuka uygun şekilde işlenmesini, saklanmasını ve korunmasını
                    amaçlayan temel düzenlemedir. Bu kanun, kişisel verilerin ancak açık rıza veya
                    kanunda belirtilen istisnai hallerde işlenebileceğini, verilerin belirli ve
                    meşru amaçlarla toplanması gerektiğini ve gerektiğinde silinmesi, yok edilmesi
                    ya da anonimleştirilmesi gerektiğini hükme bağlar. İlgili kişiler, verilerinin
                    işlenip işlenmediğini öğrenme, düzeltilmesini veya silinmesini talep etme gibi
                    haklara sahiptir; veri sorumluları ise aydınlatma yükümlülüğü, güvenlik
                    tedbirleri alma ve VERBİS’e kayıt gibi sorumluluklar taşır. KVKK, dijital çağda
                    birey mahremiyetini korumak için kritik bir yasal çerçeve sunar.
                  </div>
                </div>
              </div>
              <div class="accordion-item bg-dark text-white border-0">
                <h2 class="accordion-header bg-dark text-white border-0" id="headingTwo">
                  <button
                    class="accordion-button bg-dark text-white border-0 collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseTwo"
                    aria-expanded="false"
                    aria-controls="collapseTwo"
                  >
                    Şartlar ve Koşullar
                  </button>
                </h2>
                <div
                  id="collapseTwo"
                  class="accordion-collapse collapse bg-dark text-white border-0"
                  aria-labelledby="headingTwo"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body bg-dark text-white border-0">
                    Bu web sitesini kullanarak, kullanıcılar sunulan içerik ve hizmetleri yalnızca
                    yasal amaçlarla ve ilgili kullanım koşullarına uygun şekilde kullanmayı kabul
                    eder. Web sitesi sahibi, içeriklerin doğruluğu, kesintisiz erişim veya üçüncü
                    taraf bağlantılarla ilgili herhangi bir garanti vermez ve doğabilecek teknik
                    sorunlar, veri kayıpları veya hizmet kesintilerinden sorumlu tutulamaz.
                    Kullanıcılar, telif hakkı içeren materyalleri izinsiz paylaşmamayı ve diğer
                    kullanıcıların haklarına saygı göstermeyi taahhüt eder. Web sitesinin tüm
                    içeriği, aksi belirtilmedikçe sahibine aittir ve izinsiz çoğaltılamaz veya
                    dağıtılamaz. Bu şartlar, yerel yasal düzenlemelere göre yorumlanır ve
                    gerektiğinde güncellenebilir.
                  </div>
                </div>
              </div>
              <div class="accordion-item bg-dark text-white border-0">
                <h2 class="accordion-header bg-dark text-white border-0" id="headingThree">
                  <button
                    class="accordion-button bg-dark text-white border-0 collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseThree"
                    aria-expanded="false"
                    aria-controls="collapseThree"
                  >
                    Çerez Politikaları
                  </button>
                </h2>
                <div
                  id="collapseThree"
                  class="accordion-collapse collapse bg-dark text-white border-0"
                  aria-labelledby="headingThree"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body bg-dark text-white border-0">
                    Bu web sitesi, kullanıcı deneyimini geliştirmek ve hizmetlerin daha verimli
                    sunulmasını sağlamak amacıyla çerezler kullanmaktadır. Ziyaretiniz sırasında
                    cihazınıza yerleştirilen çerezler; oturum yönetimi, tercihlerin hatırlanması,
                    analiz ve reklam hizmetlerinin kişiselleştirilmesi gibi işlevleri yerine
                    getirir. Kullanıcılar, tarayıcı ayarları üzerinden çerezleri yönetebilir veya
                    engelleyebilir; ancak bazı çerezlerin devre dışı bırakılması, site
                    işlevselliğini olumsuz etkileyebilir. Çerez kullanımı, yürürlükteki veri koruma
                    mevzuatına uygun şekilde gerçekleştirilmekte olup, kişisel verilerin gizliliği
                    ve güvenliği öncelikli olarak gözetilmektedir.
                  </div>
                </div>
              </div>
            </div>
            <p class="text-center small fst-italic">Copyright © 2025 Tüm Hakları Saklıdır.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
